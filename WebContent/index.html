<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Olap</title>
<meta
	content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'
	name='viewport'>
<!-- bootstrap 3.0.2 -->
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<!-- font Awesome -->
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css" />
<!-- Ionicons -->
<link href="css/ionicons.min.css" rel="stylesheet" type="text/css" />
<!-- Date Picker -->
<link href="css/datepicker/datepicker3.css" rel="stylesheet"
	type="text/css" />
<!-- Daterange picker -->
<link href="css/daterangepicker/daterangepicker-bs3.css"
	rel="stylesheet" type="text/css" />
<!-- Theme style -->
<link href="css/AdminLTE.css" rel="stylesheet" type="text/css" />

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
<style type="text/css">
.imgLoading {
	background: transparent url('img/ajax-loader1.gif') 50% 50% no-repeat;"
}
</style>
</head>
<body class="skin-blue">
	<!-- header logo: style can be found in header.less -->
	<header class="header">
		<a href="index.html" class="logo"> <!-- Add the class icon to your logo image or logo icon to add the margining -->
			Adventure Works
		</a>
		<!-- Header Navbar: style can be found in header.less -->
		<nav class="navbar navbar-static-top" role="navigation">
			<!-- Sidebar toggle button-->
			<a href="#" class="navbar-btn sidebar-toggle" data-toggle="offcanvas"
				role="button"> <span class="sr-only">Toggle navigation</span> <span
				class="icon-bar"></span> <span class="icon-bar"></span> <span
				class="icon-bar"></span>
			</a>
			<div class="navbar-right">
				<ul class="nav navbar-nav">
					<!-- User Account: style can be found in dropdown.less -->
					<li class="dropdown user user-menu"><a href="#"
						class="dropdown-toggle" data-toggle="dropdown"> <i
							class="glyphicon glyphicon-user"></i> <span>Ismail Muhamad
								<i class="caret"></i>
						</span>
					</a>
						<ul class="dropdown-menu">
							<!-- User image -->
							<li class="user-header bg-light-blue"><img
								src="img/avatar04.png" class="img-circle" alt="User Image" />
								<p>
									Ismail Muhamad - Developer <small>Member since Jan.
										2012</small>
								</p></li>
							<!-- Menu Footer-->
							<li class="user-footer">
								<div class="pull-left">
									<a href="#" class="btn btn-default btn-flat">Profile</a>
								</div>
								<div class="pull-right">
									<a href="#" class="btn btn-default btn-flat">Sign out</a>
								</div>
							</li>
						</ul></li>
				</ul>
			</div>
		</nav>
	</header>
	<div class="wrapper row-offcanvas row-offcanvas-left">
		<!-- Left side column. contains the logo and sidebar -->
		<aside class="left-side sidebar-offcanvas">
			<!-- sidebar: style can be found in sidebar.less -->
			<section class="sidebar">
				<!-- Sidebar user panel -->
				<div class="user-panel">
					<div class="pull-left image">
						<img src="img/avatar04.png" class="img-circle" alt="User Image" />
					</div>
					<div class="pull-left info">
						<p>Hello, Ismail</p>
					</div>
				</div>
				<!-- cube select -->
				<div class="form-group">
					<select id="cubes" onchange="changeCube(this)" class="form-control">
						<option value="" selected="selected">--Cubes--</option>
					</select>
				</div>
				<!-- /.search form -->
				<!-- sidebar menu: : style can be found in sidebar.less -->
				<ul class="sidebar-menu">
					<div id="demo1" class="demo">
						<ul>
							<li id="phtml_1"><a href="#">Root node 1</a>
								<ul>
									<li id="phtml_2"><a href="#">Child node 1</a></li>
									<li id="phtml_3"><a href="#">Child node 2</a></li>
									<li id="phtml_4"><a href="#">Child node 3</a></li>
								</ul></li>
							<li id="phtml_5"><a href="#">Root node 2</a></li>
							<li id="phtml_6"><a href="#">Root node 2</a></li>
							<li id="phtml_7"><a href="#">Root node 2</a></li>
						</ul>
					</div>
				</ul>
			</section>
			<!-- /.sidebar -->
		</aside>

		<!-- Right side column. Contains the navbar and content of the page -->
		<aside class="right-side">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<h1>
					Dashboard <small>Control panel</small>
				</h1>
				<ol class="breadcrumb">
					<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
					<li class="active">Dashboard</li>
				</ol>
			</section>

			<!-- Main content -->
			<section class="content">
				<!-- Main row -->
				<div class="row">
					<div class="col-md-8">
						<div></div>
					</div>
					<div class="col-md-4" style="text-align: right;">
						<button id="clear" type="button" style="width: 70px" class="btn btn-primary">
							Clear <span class="fa fa-trash-o"></span>
						</button>
						<button id="run" type="button" style="width: 70px"
							class="btn btn-primary">
							Run <span class="fa fa-play"></span>
						</button>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
<!-- 						<ul id="myTab" class="nav nav-tabs" role="tablist"> -->
<!-- 							<li class=""><a href="#desain" role="tab" -->
<!-- 								data-toggle="tab">Desain</a></li> -->
<!-- 							<li class="active"><a href="#mdx" role="tab" data-toggle="tab">MDX</a></li> -->
<!-- 						</ul> -->
<!-- 						<div id="myTabContent" class="tab-content" style="height: 200px"> -->
<!-- 							<div class="tab-pane fade" id="desain"><textarea id="xx" style="height: 200px" -->
<!-- 									class="form-control">adada</textarea></div> -->
<!-- 							<div class="tab-pane fade active in" id="mdx"> -->
<!-- 								<textarea id="mdxQuery" style="height: 200px" -->
<!-- 									class="form-control">SELECT NON EMPTY {[Measures].[Reseller Tax Amount] } ON COLUMNS, NON EMPTY { ([Geography].[Geography].[Postal Code].ALLMEMBERS ) } DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM [Adventure Works]</textarea> -->
<!-- 							</div> -->
<!-- 						</div> -->
						<div class="form-group">
                        	<label>MDX Query</label>
                            <textarea id="mdxQuery" placeholder="Insert mdx query" style="height: 100px" class="form-control"> SELECT NON EMPTY {[Measures].[Reseller Sales Amount]} ON COLUMNS, NON EMPTY { ([Geography].[Country].[Country].ALLMEMBERS ) } DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM [Adventure Works]</textarea>
                        </div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div id="box-table" class="box box-solid box-primary">
							<div class="box-header">
								<h3 class="box-title">Table</h3>
								<div class="box-tools pull-right">
									<button class="btn btn-primary btn-sm" data-widget="collapse">
										<i class="fa fa-minus"></i>
									</button>
									<button class="btn btn-primary btn-sm" data-widget="remove">
										<i class="fa fa-times"></i>
									</button>
								</div>
							</div>
							<div class="box-body">
								<div id="table" style="height: 300px"></div>
							</div>
							<!-- /.box-body -->
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div id="box-chart" class="box box-solid box-primary">
							<div class="box-header">
								<h3 class="box-title">Chart</h3>
								<div class="box-tools pull-right">
									<button class="btn btn-primary btn-sm" data-widget="collapse">
										<i class="fa fa-minus"></i>
									</button>
									<button class="btn btn-primary btn-sm" data-widget="remove">
										<i class="fa fa-times"></i>
									</button>
									<select id="changeChart">
										<option value="line" selected="selected">Line Chart</option>
										<option value="area">Area Chart</option>
										<option value="column">Column Chart</option>
										<option value="bar">Bar Chart</option>
										<option value="geo">Geo Chart</option>
										<option value="maps">Maps Chart</option>
										<option value="pie">Pie Chart</option>
										<option value="donut">Donut Chart</option>
									</select>
								</div>
							</div>
							<div class="box-body">
								<div class="loading-img"></div>
								<div id="chart" style="height: 300px"></div>
							</div>
							<!-- /.box-body -->
						</div>
					</div>
				</div>
			</section>
			<!-- /.content -->
		</aside>
		<!-- /.right-side -->
	</div>
	<!-- ./wrapper -->

	<!-- add new calendar event modal -->

	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/jquery.hotkeys.js"></script>
	<!-- jQuery UI 1.10.3 -->
	<script src="js/jquery-ui-1.10.3.min.js" type="text/javascript"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js" type="text/javascript"></script>
	<!-- JsTree -->
	<script src="js/plugins/jstree/jquery.jstree.js" type="text/javascript"></script>

	<!-- AdminLTE App -->
	<script src="js/AdminLTE/app.js" type="text/javascript"></script>

	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript">
		var chartData;
		google.load("visualization", "1", {packages : [ "table" ]});
		google.load('visualization', '1', { 'packages': ['map'] });
		google.load("visualization", "1", {packages:["corechart"]});
		
		function setJsonMdx() {
			var data = $("#mdxQuery").val();
			data = data.replace(/(?:\r\n|\r|\n)/g, '');
			data = data.replace(/\s{2,}/g, ' ');
			data = encodeURIComponent(data);
			data = '[{"result" : "'+data+'"}]';
			
			//console.log(data);
			return  data;
		}
		function callDraw() {
			$.ajax({
				url: 'OlapGet?action=1&mdx='+setJsonMdx(),
				type: 'get',
				dataType: 'json',
				beforeSend: function() {
					chartData=undefined;
					
					$("#table").addClass('imgLoading');
					$("#chart").addClass('imgLoading');
				}
				,complete: function() {
					$("#table").removeClass('imgLoading');
					$("#chart").removeClass('imgLoading');
				}
			}).done(function(result) {
				//console.log('done');
				$("#table").empty();
				$("#chart").empty();
				
				if (result.isValid) {
					drawTable(result);
					drawChart(result,$("#changeChart").val());
				}else {
					alert('Error MDX Syntax or program');
				}
			});
		}
		$(document).ready(function() {
			$.getJSON("OlapGet?action=0", function(result) {
				$.each(result, function(key, value) {
					$('#cubes').append($('<option>', {
						value : value
					}).text(value));
				});
			});


// didisable, masih bermasalah, call trus			
// 			$(window).resize(function() {
// 				callDraw();
// 			});
			
			$('#myTab a').click(function(e) {
				e.preventDefault();
				$(this).tab('show');
			});

			$("#demo1").jstree({
				// the `plugins` array allows you to configure the active plugins on this instance
				"plugins" : [ "themes", "html_data", "ui", "crrm", "hotkeys" ],
				// each plugin you have included can have its own config object
				"core" : {
					"animation" : 100,
					"initially_open" : [ "phtml_1" ]
				}
				// set a theme
				,
				"themes" : {
					"theme" : "proton"
				}
			});
			$("#run").click(function() {
				$("#table").empty();
				$("#chart").empty();
				chartData=undefined;
				callDraw();
			});
			$("#changeChart").change(function() {
				drawChart(chartData,$(this).val());
			});
			$("#clear").click(function() {
				$("#mdxQuery").empty();
				$("#table").empty();
				$("#chart").empty();
				chartData=undefined;
			});
		})

		function drawTable(result) {
			//console.log(result);
			
			var data = new google.visualization.DataTable();

			for ( var i = 0; i < result.field.length; i++) {
				data.addColumn(result.field[i].columnType,result.field[i].columnName);
			}
			data.addRows( result.content );

			var table = new google.visualization.Table(document.getElementById('table'));

			table.draw(data, {
				showRowNumber : true,
				width : "100%"
			});	
		}
		
		function drawChart(result,typeChart) {
			//console.log(result);
			//console.log(chartData);
			if (result == undefined) {
				return;
			}
			chartData=result;
			var data = google.visualization.arrayToDataTable( chartData.contentAll );
			var options = {
				title : 'MDX Chart',
				legend: 'bottom',
				hAxis : {
					title : 'Category',
					titleTextStyle : {
						color : 'red'
					}
				},
				width : "100%"
			};

			var chart;
			if (typeChart == 'line') {
				chart = new google.visualization.LineChart(document.getElementById('chart'));
			}else if (typeChart == 'area') {
				chart = new google.visualization.AreaChart(document.getElementById('chart'));
			}else if (typeChart == 'column') {
				chart = new google.visualization.ColumnChart(document.getElementById('chart'));
			}else if (typeChart == 'bar') {
				chart = new google.visualization.BarChart(document.getElementById('chart'));
			}else if (typeChart == 'geo') {
				options = {};
				chart = new google.visualization.GeoChart(document.getElementById('chart'));
			}else if (typeChart == 'maps') {
				options = { showTip: true };
				chart = new google.visualization.Map(document.getElementById('chart'));
			}else  if (typeChart == 'pie') {
				options = {title: 'MDX Chart',is3D: true};
				chart = new google.visualization.PieChart(document.getElementById('chart'));
			}else {
				options = {title: 'MDX Chart',pieHole: 0.4};
				chart = new google.visualization.PieChart(document.getElementById('chart'));
			}
			google.visualization.events.addListener(chart, 'error', function(err) {
				$("#chart").empty();
				$("#chart").html('<p style="color : red">'+err.message+'</p>');
			})
			
			chart.draw(data, options);
		}
		
		function changeCube(obj) {
			//console.log($(obj).val());
		}
	</script>
</body>
</html>